schema_version: 1.0
plan_id: gemini-advanced-demo-20251110
name: Gemini Advanced Adapter Demo
status: planned
created_at: "2025-11-10T12:00:00Z"
last_updated: "2025-11-10T12:00:00Z"
created_by: demo@agentflow.local
version: 1
tags:
  - gemini
  - adapter
  - flow-spec
  - branching
context:
  objective: "Demonstrate Gemini adapter producing a branching + loop flow with evaluation nodes."
  notes: |
    This is a hand-authored artifact for demonstration & PRD purposes.
    The execution engine will convert prompts and responses into runtime nodes.
    Use the environment variables below before running a live generation with the CLI:
      set AGENTFLOW_ADAPTER=gemini
      set AGENTFLOW_GEMINI_API_KEY=ya29.xxx
      set AGENTFLOW_GEMINI_MODEL=gemini-1.5-flash
      set AGENTFLOW_GEMINI_MAX_TOKENS=512
vars:
  dataset_path: "sandbox/data/input.txt"
  retry_limit: 2
metrics:
  total_nodes: 0
  completed: 0
  in_progress: 0
  pending: 0
  blocked: 0
nodes:
  - id: generate_initial_flow
    type: agent
    summary: "Ask Gemini to propose a LangGraph with branch + loop"
    depends_on: []
    status: pending
    attempt: 0
    inputs:
      prompt: |
        You are designing an AgentFlow LangGraph. Requirements:
        - Read the file at {{ vars.dataset_path }}.
        - Summarize its contents.
        - Branch: if the summary length > 200 chars go to refine_summary, else go to short_summary_path.
        - Loop: Up to 2 iterations improving the summary clarity.
        - Include an evaluation node that scores summary coherence (0-1).
        Return valid JSON under the key flow_spec with arrays nodes and edges.
    outputs: {}
    artifacts: []
    metrics: {}
    timeline: {}
    history: []

  - id: refine_summary
    type: agent
    summary: "Refine long summary for clarity"
    depends_on: [generate_initial_flow]
    status: pending
    attempt: 0
    inputs:
      prompt: |
        Improve the long summary from previous node to be concise (< 150 chars) without losing key points.
        Return improved text only.
    outputs: {}
    artifacts: []
    metrics: {}
    timeline: {}
    history: []

  - id: short_summary_path
    type: agent
    summary: "Accept short summary and annotate"
    depends_on: [generate_initial_flow]
    status: pending
    attempt: 0
    inputs:
      prompt: |
        The summary was short enough. Add a one-line annotation: "[OK: concise]" at the end and return.
    outputs: {}
    artifacts: []
    metrics: {}
    timeline: {}
    history: []

  - id: summary_evaluation
    type: agent
    summary: "Self-evaluate summary coherence"
    depends_on: [refine_summary, short_summary_path]
    status: pending
    attempt: 0
    inputs:
      prompt: |
        Evaluate the final summary for coherence and accuracy.
        Return a JSON object {"score": <float 0-1>, "justification": "..."}.
    outputs: {}
    artifacts: []
    metrics: {}
    timeline: {}
    history: []

  - id: compile_flow_spec
    type: agent
    summary: "Inject synthetic nodes and edges for viewer"
    depends_on: [summary_evaluation]
    status: pending
    attempt: 0
    inputs:
      prompt: |
        Combine earlier outputs into a final flow_spec with nodes: generate_initial_flow, (loop iterations), refine_summary OR short_summary_path, summary_evaluation.
        Provide edges with a conditional branch and a loop edge referencing iteration counts.
    outputs: {}
    artifacts: []
    metrics: {}
    timeline: {}
    history: []

rollup:
  completion_percentage: 0
  critical_path: [generate_initial_flow, refine_summary, summary_evaluation, compile_flow_spec]
  alerts: []
  last_writer: "author@manual"
